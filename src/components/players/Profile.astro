---
import { api, type Player, type Series } from "@/lib/api";
import PositionHistory from "./PositionHistory.astro";

export type ProfileProps = {
  playerId: string, 
  fromSeriesId: string, 
  toSeriesId: string, 
};

const { playerId, fromSeriesId, toSeriesId } = Astro.props as ProfileProps;

const player = await api.getPlayer(playerId) as Player;
const allSeries = await api.getSeries() as Series[]

// Find selected series names for display
const fromSeries = fromSeriesId ? allSeries.find(s => s._id === fromSeriesId) : null;
const toSeries = toSeriesId ? allSeries.find(s => s._id === toSeriesId) : null;
const rangeText = fromSeries && toSeries ? `${fromSeries.name} - ${toSeries.name}` : "All Series";

---
<!-- Player Header -->
<div class="flex items-start justify-between gap-6">
  <!-- Left: Avatar and Name -->
  <div class="flex items-center gap-6">
    <div class="relative">
      <img
        src={player.picture}
        alt={player.name}
        class="w-24 h-24 rounded-full object-cover"
      />
      <div
        class="absolute -bottom-2 -right-2 w-8 h-8 rounded-full border-4 border-background"
        style={`background-color: ${player.color}`}
      />
    </div>
    <div>
      <h1 class="text-4xl font-bold">{player.name}</h1>
      <p class="text-muted-foreground">Player Statistics ({rangeText})</p>
    </div>
  </div>

  <!-- Right: Position Medals -->
  <PositionHistory
    playerId={playerId}
    fromSeriesId={fromSeriesId}
    toSeriesId={toSeriesId}
    server:defer
  />
</div>